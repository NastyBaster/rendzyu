<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>–†–µ–Ω–¥–∑—é –æ–Ω–ª–∞–π–Ω</title>
  <style>
    body { display:flex; justify-content:center; align-items:center; flex-direction: column; height:100vh; background:#f0f0f0; margin:0; }
    canvas { background:#f9d58a; box-shadow:0 0 10px rgba(0,0,0,0.5); cursor:pointer; }
    button { margin-top: 10px; padding: 5px 10px; font-size:16px; }
  </style>
</head>
<body>
  <canvas id="board" width="600" height="600"></canvas>
  <button id="reset">–ù–æ–≤–∞ –≥—Ä–∞</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

  <script>
    // üîπ –≤—Å—Ç–∞–≤ —Ç—É—Ç —Å–≤–æ—ó –¥–∞–Ω—ñ –∑ Firebase Console
    const firebaseConfig = {
      apiKey: "AIzaSyBXnor_Y2N9HFNqHI7hs8HBF2MRxJFTIq4",
      authDomain: "rendzyu-ed6bf.firebaseapp.com",
      databaseURL: "https://rendzyu-ed6bf-default-rtdb.firebaseio.com",
      projectId: "rendzyu-ed6bf",
      storageBucket: "rendzyu-ed6bf.firebasestorage.app",
      messagingSenderId: "928258814163",
      appId: "1:928258814163:web:48cbcdfaa01f9f030fe426",
      measurementId: "G-SYK9RLDKQ5"
    };

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const canvas = document.getElementById("board");
    const ctx = canvas.getContext("2d");
    const size = 15;
    const cell = canvas.width / size;
    let board = Array.from({length:size},()=>Array(size).fill(null));
    let current = "black"; 

    // Firebase refs
    const movesRef = db.ref("moves");
    const currentRef = db.ref("current");

    // –ú–∞–ª—é—î–º–æ –¥–æ—à–∫—É
    function drawBoard() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 1;
      for (let i=0;i<size;i++){
        ctx.beginPath();
        ctx.moveTo(cell/2, cell/2+i*cell);
        ctx.lineTo(canvas.width-cell/2, cell/2+i*cell);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(cell/2+i*cell, cell/2);
        ctx.lineTo(cell/2+i*cell, canvas.height-cell/2);
        ctx.stroke();
      }
      // –∫–∞–º–µ–Ω—ñ
      for (let y=0;y<size;y++){
        for (let x=0;x<size;x++){
          if(board[y][x]){
            ctx.beginPath();
            ctx.arc(cell/2 + x*cell, cell/2 + y*cell, cell*0.4, 0, Math.PI*2);
            ctx.fillStyle = board[y][x];
            ctx.shadowColor = "rgba(0,0,0,0.3)";
            ctx.shadowBlur = 5;
            ctx.fill();
            ctx.shadowBlur = 0;
          }
        }
      }
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–º–æ–∂—Ü—è
    function checkWinner(x, y, color) {
      const directions = [
        [[1,0],[-1,0]],   // –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å
        [[0,1],[0,-1]],   // –≤–µ—Ä—Ç–∏–∫–∞–ª—å
        [[1,1],[-1,-1]],  // –¥—ñ–∞–≥–æ–Ω–∞–ª—å \
        [[1,-1],[-1,1]]   // –¥—ñ–∞–≥–æ–Ω–∞–ª—å /
      ];
      for (let dir of directions){
        let count = 1;
        for (let [dx,dy] of dir){
          let nx = x, ny = y;
          while(true){
            nx += dx;
            ny += dy;
            if(nx<0||ny<0||nx>=size||ny>=size) break;
            if(board[ny][nx]===color) count++;
            else break;
          }
        }
        if(count >= 5) return true;
      }
      return false;
    }

    // –°–ª—É—Ö–∞—î–º–æ –±–∞–∑—É
    movesRef.on("value", snapshot => {
      const moves = snapshot.val() || {};
      board = Array.from({length:size},()=>Array(size).fill(null));
      for(let key in moves){
        const {x,y,color} = moves[key];
        board[y][x] = color;
      }
      drawBoard();
    });

    currentRef.on("value", snapshot => {
      current = snapshot.val() || "black";
    });

    // –ö–ª—ñ–∫
    canvas.addEventListener("click", e => {
      const rect = canvas.getBoundingClientRect();
      const x = Math.round((e.clientX - rect.left - cell/2) / cell);
      const y = Math.round((e.clientY - rect.top - cell/2) / cell);
      if(x<0||y<0||x>=size||y>=size) return;
      if(!board[y][x]){
        const move = {x,y,color:current};
        movesRef.push(move); 
        if(checkWinner(x,y,current)){
          alert(current.toUpperCase() + " –≤–∏–≥—Ä–∞–≤!");
          return;
        }
        currentRef.set(current==="black"?"white":"black");
      }
    });

    // –ù–æ–≤–∞ –≥—Ä–∞
    document.getElementById("reset").addEventListener("click", () => {
      movesRef.remove();
      currentRef.set("black");
    });

    drawBoard();
  </script>
</body>
</html>
